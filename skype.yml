---
- hosts: all
  become: yes
  become_user: root
  tasks:
      - name: Assertions
        assert:
          that:
              - ansible_architecture in [ 'x86_64', 'x86' ]
              - ansible_pkg_mgr == 'apt'

      - name: Add i386 architecture to dpkg
        command: /usr/bin/dpkg --add-architecture i386
        changed_when: False

      - name: APT install dependencies
        with_items:
            - libc6:i386
            - libqt4-dbus:i386
            - libqt4-network:i386
            - libqt4-xml:i386
            - libqtcore4:i386
            - libqtgui4:i386
            - libqtwebkit4:i386
            - libstdc++6:i386
            - libx11-6:i386
            - libxext6:i386
            - libxss1:i386
            - libxv1:i386
            - libssl1.0.0:i386
            - libpulse0:i386
            - libasound2-plugins:i386
        apt:
            name: '{{ item }}'
            state: present
            update_cache: yes
            cache_valid_time: 3600

      - name: Get Skype Debian package
        get_url:
            src: http://www.skype.com/go/getskype-linux-deb
            dest: /root/skype.deb

      - name: Install Skype Debian package
        apt:
            deb: /root/skype.deb
            state: present
